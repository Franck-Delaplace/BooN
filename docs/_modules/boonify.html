<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>boonify &mdash; BooN 1.03 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=ede5f57a"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BooN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BooN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">boonify</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for boonify</h1><div class="highlight"><pre>
<span></span><span class="c1"># Graphical interface for BooN design and analysis</span>
<span class="c1"># Author: Franck Delaplace</span>
<span class="c1"># Creation date: February 2024</span>

<span class="c1"># In comments :</span>
<span class="c1"># DEF means definition which is a code part gathering functions related to a process or an object definition,</span>
<span class="c1"># STEP means main steps</span>
<span class="c1"># WARNING is a warning.</span>
<span class="c1"># These terms can be used to color comments in PyCharm or else.</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">BooNGui.booneries_rc</span>  <span class="c1"># resources</span>

<span class="kn">import</span> <span class="nn">boon</span>
<span class="kn">from</span> <span class="nn">boon</span> <span class="kn">import</span> <span class="n">BooN</span><span class="p">,</span> <span class="n">SIGNCOLOR</span><span class="p">,</span> <span class="n">COLORSIGN</span><span class="p">,</span> <span class="n">EXTSBML</span><span class="p">,</span> <span class="n">EXTXT</span>
<span class="kn">import</span> <span class="nn">logic</span>
<span class="kn">from</span> <span class="nn">logic</span> <span class="kn">import</span> <span class="n">LOGICAL</span><span class="p">,</span> <span class="n">SYMPY</span><span class="p">,</span> <span class="n">MATHEMATICA</span><span class="p">,</span> <span class="n">JAVA</span>

<span class="kn">from</span> <span class="nn">sympy.logic.boolalg</span> <span class="kn">import</span> <span class="n">is_cnf</span><span class="p">,</span> <span class="n">is_dnf</span><span class="p">,</span> <span class="n">is_nnf</span>
<span class="kn">from</span> <span class="nn">sympy.core.symbol</span> <span class="kn">import</span> <span class="n">Symbol</span>
<span class="kn">from</span> <span class="nn">sympy.logic.boolalg</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Not</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">SOPform</span><span class="p">,</span> <span class="n">symbols</span>
<span class="kn">from</span> <span class="nn">sympy.parsing.sympy_parser</span> <span class="kn">import</span> <span class="n">parse_expr</span>

<span class="kn">from</span> <span class="nn">netgraph</span> <span class="kn">import</span> <span class="n">EditableGraph</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt5.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QStandardItemModel</span><span class="p">,</span> <span class="n">QStandardItem</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QSize</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWebEngineWidgets</span> <span class="kn">import</span> <span class="n">QWebEngineView</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Qt5Agg&quot;</span><span class="p">)</span>

<span class="c1"># Parameters</span>
<span class="n">HSIZE</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># size of the history</span>
<span class="n">STYLE</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Logical&quot;</span><span class="p">:</span> <span class="n">LOGICAL</span><span class="p">,</span> <span class="s2">&quot;Java&quot;</span><span class="p">:</span> <span class="n">JAVA</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">:</span> <span class="n">SYMPY</span><span class="p">,</span> <span class="s2">&quot;Mathematica&quot;</span><span class="p">:</span> <span class="n">MATHEMATICA</span><span class="p">}</span>
<span class="n">ICON01</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;:/icon/resources/none.svg&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;:/icon/resources/true.svg&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;:/icon/resources/false.svg&quot;</span><span class="p">}</span>  <span class="c1"># True/False icons</span>
<span class="n">MODELBOUND</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Size bound of the dynamics model in terms of variables.</span>

<span class="c1"># Node names for the pattern network</span>
<span class="n">REG</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u03b1</span><span class="s1">&#39;</span>  <span class="c1"># lambda</span>
<span class="n">POS</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u03b2</span><span class="s1">&#39;</span>  <span class="c1"># alpha</span>
<span class="n">NEG</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u03bb</span><span class="s1">&#39;</span>  <span class="c1"># beta</span>

<span class="c1"># Integer regular expression</span>
<span class="n">INTPAT</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\s*-?[0-9]+\s*&quot;</span>


<div class="viewcode-block" id="Boonify">
<a class="viewcode-back" href="../index.html#boonify.Boonify">[docs]</a>
<span class="k">class</span> <span class="nc">Boonify</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main Class of the GUI&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Boonify</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/boonify.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

        <span class="c1"># STEP: initialize the Gui state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boon</span> <span class="o">=</span> <span class="n">BooN</span><span class="p">()</span>  <span class="c1"># Current BooN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Current filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">HSIZE</span>  <span class="c1"># History</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Index of the last BooN added in the  history.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hupdate</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag determining whether the history is updated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Flag determining whether the current BooN is saved, initially False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boonsaved</span><span class="p">()</span>  <span class="c1"># also pen the status bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QView</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Widget of the View</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Widget of the stable states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Widget of the dynamics model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Widget of the controllability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Graph for edition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Flag indicating whether the BooN design callback function is enabled, initially disabled (True) because the editgraph is not set up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">=</span> <span class="mf">2.</span>  <span class="c1"># Size related to the EditableGraph and used for many parameters. It is modified when the window is rescaled to let the nodes and edges width invariant.</span>
        <span class="c1"># STEP: Connect callback functions to Menu</span>

        <span class="c1"># File</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionOpen</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionSave</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionSaveAs</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionImport</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">importation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionExport</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exportation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionQuit</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>

        <span class="c1"># Help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionHelp</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionUndo</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionRedo</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redo</span><span class="p">)</span>

        <span class="c1"># Network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionView</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionModel</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionStableStates</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stablestates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActionControllability</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controllability</span><span class="p">)</span>

        <span class="c1"># STEP: Initialization of a thread for long run application --&gt; controllability</span>
        <span class="c1"># The thread is created and started.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">Threader</span><span class="p">()</span>

        <span class="c1"># STEP: Initialize the Canvas for network design</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c1"># plt.figure is necessary to create a manager</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># adjust the window s.t. the network fully fill it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">manager</span>  <span class="c1"># assign the manager in the canvas to be accessible by EditGraph.</span>

        <span class="c1"># STEP: Enable key_press_event events for using EditGraph:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ClickFocus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>

        <span class="c1"># STEP: Insert the network design figure in the main window.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DesignCanvas</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="c1"># STEP: set up network design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span>

    <span class="c1"># DEF: NETWORK DESIGN</span>
<div class="viewcode-block" id="Boonify.setup_design">
<a class="viewcode-back" href="../index.html#boonify.Boonify.setup_design">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up of the editable graph.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Disable the design callback during the set-up.</span>

        <span class="c1"># STEP: Creation of the pattern-network used for edge styling.</span>
        <span class="c1"># To prevent its inclusion in the BooN, the variable names are strings while the other nodes are integers or symbols.</span>
        <span class="c1"># network structure:  NEG &lt;--[-]-- REG --[+]--&gt; POS</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">([(</span><span class="n">REG</span><span class="p">,</span> <span class="n">POS</span><span class="p">),</span> <span class="p">(</span><span class="n">REG</span><span class="p">,</span> <span class="n">NEG</span><span class="p">)])</span>
        <span class="n">edge_color</span> <span class="o">=</span> <span class="p">{(</span><span class="n">REG</span><span class="p">,</span> <span class="n">POS</span><span class="p">):</span> <span class="n">SIGNCOLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">REG</span><span class="p">,</span> <span class="n">NEG</span><span class="p">):</span> <span class="n">SIGNCOLOR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">NEG</span><span class="p">,</span> <span class="n">NEG</span><span class="p">):</span> <span class="n">SIGNCOLOR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">):</span> <span class="n">SIGNCOLOR</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">{</span><span class="n">NEG</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.045</span><span class="p">),</span> <span class="n">REG</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.045</span><span class="p">),</span> <span class="n">POS</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.045</span><span class="p">)}</span>

        <span class="c1"># STEP: Extend this network by adding the interaction graph of the current BooN.</span>
        <span class="n">ig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">interaction_graph</span>  <span class="c1"># Get the IG.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">ig</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">ig</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>

        <span class="c1"># STEP: find the edge color from signs.</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">ig</span><span class="p">,</span> <span class="s1">&#39;sign&#39;</span><span class="p">)</span>
        <span class="n">edge_color</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">edge</span><span class="p">:</span> <span class="n">SIGNCOLOR</span><span class="p">[</span><span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">]]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">signs</span><span class="p">})</span>  <span class="c1"># Transform sign in color.</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>  <span class="c1"># Complete the position.</span>

        <span class="c1"># STEP: Convert the module ids to string labeling the edge.</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">ig</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">)</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">[</span><span class="n">edge</span><span class="p">]])</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">}</span>

        <span class="c1"># STEP: Define the editgraph.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="c1"># WARNING : the definition of EditableGraph is the same as the definition in resizeEvent function. Any modification of one must be reported to the other.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span> <span class="o">=</span> <span class="n">EditableGraph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span>
                                       <span class="n">node_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;antiquewhite&#39;</span><span class="p">,</span>
                                       <span class="n">node_edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                       <span class="n">node_label_fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">),</span>
                                       <span class="n">node_layout</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span>
                                       <span class="n">node_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span><span class="p">,</span>
                                       <span class="n">node_edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                                       <span class="n">node_label_offset</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">designsize</span><span class="p">),</span>
                                       <span class="n">edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                       <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">edge_labels</span><span class="o">=</span><span class="n">modules</span><span class="p">,</span>
                                       <span class="n">edge_label_position</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                                       <span class="n">edge_label_fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">),</span>
                                       <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
                                       <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Enable the design callback.</span></div>


<div class="viewcode-block" id="Boonify.design">
<a class="viewcode-back" href="../index.html#boonify.Boonify.design">[docs]</a>
    <span class="k">def</span> <span class="nf">design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;interaction graph design callback.&quot;&quot;&quot;</span>
        <span class="c1"># The function captures the events of the EditableGraph and complete the BooN.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span><span class="p">:</span> <span class="k">return</span>  <span class="c1"># Check whether the callback is enabled otherwise return.</span>

        <span class="c1"># DEF: Definition of the interaction graph of the network from the drawing.</span>
        <span class="c1"># The graph was derived from the graph drawing process.</span>
        <span class="c1"># Arc signs are associated with their color.</span>
        <span class="c1"># Only nodes with a label are used to define the graph.</span>

        <span class="c1"># STEP: Find consistent nodes corresponding to the variables in the BooN.</span>
        <span class="c1"># Consistent nodes are symbols or integers.</span>
        <span class="c1"># Dictionary of consistent nodes id:symbol, where the symbol is defined from the node label.</span>
        <span class="c1"># Recall that only the labeled nodes are kept in editgraph.node_label_artists. The unlabelled nodes are not considered.</span>
        <span class="c1"># WARNING: As nodes of the pattern network are strings, they are never selected as consistent nodes.</span>

        <span class="n">idvar</span> <span class="o">=</span> <span class="p">{</span><span class="n">idt</span><span class="p">:</span> <span class="n">symbols</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span> <span class="k">for</span> <span class="n">idt</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">node_label_artists</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idt</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Symbol</span><span class="p">)}</span>

        <span class="c1"># Function setting edges in symbolic form where nodes are all symbols.</span>
        <span class="k">def</span> <span class="nf">symbolic</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;set edges in symbolic form where node labels are symbols&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">idvar</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">idvar</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># STEP: Select the edges with consistent nodes. The other edges cannot be included in the IG.</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_artists</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">idvar</span> <span class="ow">and</span> <span class="n">tgt</span> <span class="ow">in</span> <span class="n">idvar</span><span class="p">}</span>

        <span class="c1"># STEP: define the positions of nodes. The positions are kept in a dictionary { node:pos ..}</span>
        <span class="n">edit_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">node_positions</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span><span class="n">idvar</span><span class="p">[</span><span class="n">idt</span><span class="p">]:</span> <span class="n">edit_pos</span><span class="p">[</span><span class="n">idt</span><span class="p">]</span> <span class="k">for</span> <span class="n">idt</span> <span class="ow">in</span> <span class="n">idvar</span><span class="p">}</span>

        <span class="c1"># STEP: Find signs from the edge colors.</span>
        <span class="c1"># WARNING: The face color is (r,g,b,a) while the sign colors are (r,g,b). Hence a must be removed.</span>
        <span class="n">edge_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_artists</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="n">COLORSIGN</span><span class="p">[</span><span class="n">edge_attributes</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">}</span>

        <span class="c1"># STEP: Determination of the modules from edge label.</span>

        <span class="n">edge_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_label_artists</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">edge_labels</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="c1"># A module is a list of signed integers separated by spaces. The labels that are not integers are not considered.</span>
                <span class="n">modularity</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">INTPAT</span><span class="p">,</span> <span class="n">module</span><span class="p">)}</span>

                <span class="k">if</span> <span class="n">modularity</span><span class="p">:</span>
                    <span class="c1"># re-set the label sign  w.r.t. the edge sign, used if the labels are not properly defined by the user.</span>
                    <span class="k">match</span> <span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">]:</span>
                        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Positive</span>
                            <span class="n">modularity</span> <span class="o">=</span> <span class="p">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modularity</span><span class="p">}</span>
                        <span class="k">case</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Negative</span>
                            <span class="n">modularity</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modularity</span><span class="p">}</span>
                        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># undefined (both) - non-monotone interaction</span>
                            <span class="k">pass</span>
                    <span class="n">modules</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">symbolic</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span> <span class="n">modularity</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">modules</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">symbolic</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span> <span class="p">{</span><span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">]}})</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># No edge labels = no modules =&gt; the module is the sign.</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">symbolic</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span> <span class="p">{</span><span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">]}})</span>

        <span class="c1"># STEP: Convert the edges symbolically for signs.</span>
        <span class="c1"># WARNING: as signs dict is previously used for determining the modules with string as keys, the conversion can only be achieved here.</span>
        <span class="n">signs</span> <span class="o">=</span> <span class="p">{</span><span class="n">symbolic</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span> <span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">signs</span><span class="p">}</span>

        <span class="c1"># DEF conversion of the IG to BooN</span>

        <span class="c1"># STEP: Define the ig from the editable graph.</span>
        <span class="n">ig</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="n">ig</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">idvar</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>  <span class="c1"># add nodes</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">signs</span><span class="p">:</span>  <span class="c1"># add edges</span>
            <span class="n">ig</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sign</span><span class="o">=</span><span class="n">signs</span><span class="p">[</span><span class="n">edge</span><span class="p">],</span> <span class="n">module</span><span class="o">=</span><span class="n">modules</span><span class="p">[</span><span class="n">edge</span><span class="p">])</span>

        <span class="c1"># STEP: Convert the ig to BooN.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">from_ig</span><span class="p">(</span><span class="n">ig</span><span class="p">)</span>  <span class="c1"># Find the BooN from the ig.</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># To prevent the transient error due to edge labeling.</span>
            <span class="k">pass</span>

        <span class="c1"># STEP:  Store positions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>

        <span class="c1"># DEF: Update the history and refresh the open windows.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_history</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hupdate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.resizeEvent">
<a class="viewcode-back" href="../index.html#boonify.Boonify.resizeEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify graph parameters so that node and edge widths are invariant to window resizing.&quot;&quot;&quot;</span>
        <span class="c1"># STEP: Fix the size related to the network design</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameGeometry</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameGeometry</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">1350</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">)</span>  <span class="c1"># heuristic function providing the designsize w.r.t. to window size.</span>

        <span class="c1"># STEP: retrieve all parameters of editgraph</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">node_positions</span>
        <span class="n">edge_color</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_artists</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_artists</span><span class="p">}</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_label_artists</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edge_label_artists</span><span class="p">}</span>
        <span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">idt</span><span class="p">:</span> <span class="n">text</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">idt</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">node_label_artists</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># STEP: Define a new Editable graph with size updated.</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># WARNING : the definition of EditableGraph is the same as the definition in setup_design function. Any modification of one must be reported to the other.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editgraph</span> <span class="o">=</span> <span class="n">EditableGraph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span>
                                       <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span>  <span class="c1"># node labels must be explicitly defined to avoid unwanted integer labeling.</span>
                                       <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;antiquewhite&#39;</span><span class="p">,</span>
                                       <span class="n">node_edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                       <span class="n">node_label_fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">),</span>
                                       <span class="n">node_layout</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span>
                                       <span class="n">node_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span><span class="p">,</span>
                                       <span class="n">node_edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                                       <span class="n">node_label_offset</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">designsize</span><span class="p">),</span>
                                       <span class="n">edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">designsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                       <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">edge_labels</span><span class="o">=</span><span class="n">modules</span><span class="p">,</span>
                                       <span class="n">edge_label_position</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                                       <span class="n">edge_label_fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">),</span>
                                       <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
                                       <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span></div>


    <span class="c1"># DEF: FILE MANAGEMENT</span>
<div class="viewcode-block" id="Boonify.open">
<a class="viewcode-back" href="../index.html#boonify.Boonify.open">[docs]</a>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open file dialog.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Boon Files (*.boon);; All Files (*);;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_raz</span><span class="p">()</span>  <span class="c1"># clear history</span></div>


<div class="viewcode-block" id="Boonify.save">
<a class="viewcode-back" href="../index.html#boonify.Boonify.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save file dialog.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boonsaved</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.saveas">
<a class="viewcode-back" href="../index.html#boonify.Boonify.saveas">[docs]</a>
    <span class="k">def</span> <span class="nf">saveas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save as file as dialog.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Boon Files (*.boon);; All Files (*);;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boonsaved</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.importation">
<a class="viewcode-back" href="../index.html#boonify.Boonify.importation">[docs]</a>
    <span class="k">def</span> <span class="nf">importation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Import file dialog.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Import from files&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Text or SBML Files (*.txt *.xml *.sbml);; All Files (*);;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># no file name since the BooN is not saved in the internal format.</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">match</span> <span class="n">extension</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;.txt&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">from_textfile</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">case</span> <span class="s2">&quot;.sbml&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">from_sbmlfile</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">case</span> <span class="s2">&quot;.xml&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">from_sbmlfile</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;File extension error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The extension is unknown. </span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="se">\n</span><span class="s2">Admitted extension: .txt, .sbml, .xml&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_raz</span><span class="p">()</span>  <span class="c1"># clear history</span></div>


<div class="viewcode-block" id="Boonify.exportation">
<a class="viewcode-back" href="../index.html#boonify.Boonify.exportation">[docs]</a>
    <span class="k">def</span> <span class="nf">exportation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export file dialog.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Export to text file.&quot;</span><span class="p">,</span> <span class="s2">&quot;Text Files (*.txt);; All Files (*);;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">to_textfile</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="Boonify.quit">
<a class="viewcode-back" href="../index.html#boonify.Boonify.quit">[docs]</a>
    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Quit application.&quot;&quot;&quot;</span>
        <span class="c1"># check if the BooN is saved</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved</span><span class="p">:</span>
            <span class="n">quitting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Otherwise ask whether it must be saved.</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s2">&quot;Quit&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Are you sure you want to quit? </span><span class="se">\n</span><span class="s2">The BooN is not saved.&quot;</span><span class="p">,</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Close</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span>
            <span class="k">match</span> <span class="n">reply</span><span class="p">:</span>
                <span class="k">case</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="n">quitting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">case</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Close</span><span class="p">:</span>
                    <span class="n">quitting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">case</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                    <span class="n">quitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="n">quitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">quitting</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>


    <span class="c1"># noinspection PyMethodOverriding</span>
<div class="viewcode-block" id="Boonify.closeEvent">
<a class="viewcode-back" href="../index.html#boonify.Boonify.closeEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close window&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>  <span class="c1"># WARNING: If the application is closed, this line will not be executed.</span></div>


    <span class="c1"># DEF: HISTORY MANAGEMENT</span>
<div class="viewcode-block" id="Boonify.history_raz">
<a class="viewcode-back" href="../index.html#boonify.Boonify.history_raz">[docs]</a>
    <span class="k">def</span> <span class="nf">history_raz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the history.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">HSIZE</span>  <span class="c1"># History cleaning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Index of the last BooN added in the  history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_history</span><span class="p">()</span>  <span class="c1"># Initialize the history with the current BooN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hupdate</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag determining whether the history is updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boonsaved</span><span class="p">()</span>  <span class="c1"># The BooN is saved.</span></div>


<div class="viewcode-block" id="Boonify.undo">
<a class="viewcode-back" href="../index.html#boonify.Boonify.undo">[docs]</a>
    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Undo operation.&quot;&quot;&quot;</span>
        <span class="n">hindex</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">HSIZE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Prevent disruptive updates by disabling callback.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]</span>  <span class="c1"># restore the previous BooN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">=</span> <span class="n">hindex</span>  <span class="c1"># update the history index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.redo">
<a class="viewcode-back" href="../index.html#boonify.Boonify.redo">[docs]</a>
    <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redo operation.&quot;&quot;&quot;</span>
        <span class="n">hindex</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">HSIZE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Prevent disruptive updates by disabling callback.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy the current Boon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">=</span> <span class="n">hindex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.add_history">
<a class="viewcode-back" href="../index.html#boonify.Boonify.add_history">[docs]</a>
    <span class="k">def</span> <span class="nf">add_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add current BooN to the history.&quot;&quot;&quot;</span>
        <span class="n">hindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boon</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]:</span>  <span class="c1"># WARNING: The BooN comparison operates on descriptors only.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Prevent disruptive updates by disabling callback.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hupdate</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Descriptor is changed.</span>

            <span class="n">hindex</span> <span class="o">=</span> <span class="p">(</span><span class="n">hindex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">HSIZE</span>  <span class="c1"># Update the history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="o">=</span> <span class="n">hindex</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">hindex</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span><span class="p">:</span>  <span class="c1"># The current BooN is modified</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boonsaved</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">disablecallback</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Enable the design callback</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hupdate</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># No changes.</span></div>


        <span class="c1"># PRINT THE HISTORY</span>
        <span class="c1"># self.show_history()</span>

<div class="viewcode-block" id="Boonify.show_history">
<a class="viewcode-back" href="../index.html#boonify.Boonify.show_history">[docs]</a>
    <span class="k">def</span> <span class="nf">show_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the history.&quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="p">[([</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hindex</span> <span class="k">else</span> <span class="n">i</span><span class="p">,</span>
                 <span class="n">tabulate</span><span class="p">([(</span><span class="n">var</span><span class="p">,</span> <span class="n">logic</span><span class="o">.</span><span class="n">prettyform</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">theboon</span><span class="o">.</span><span class="n">style</span><span class="p">))</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">eq</span> <span class="ow">in</span> <span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">theboon</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">theboon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)]</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="Boonify.refresh">
<a class="viewcode-back" href="../index.html#boonify.Boonify.refresh">[docs]</a>
    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the opened widgets.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QView</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">QView</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>  <span class="c1"># Refresh the BooN View if opened.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QView</span><span class="o">.</span><span class="n">initialize_view</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>  <span class="c1"># Refresh the stable states View if opened.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span><span class="o">.</span><span class="n">stablestates</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>  <span class="c1"># Refresh the Model view if opened.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span><span class="o">.</span><span class="n">modeling</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>  <span class="c1"># Refresh the Controllability View if opened.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span><span class="o">.</span><span class="n">initialize_controllability</span><span class="p">()</span></div>


    <span class="c1"># DEF: WIDGETS OPENING</span>
<div class="viewcode-block" id="Boonify.help">
<a class="viewcode-back" href="../index.html#boonify.Boonify.help">[docs]</a>
    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Help View&quot;&quot;&quot;</span>
        <span class="n">thehelp</span> <span class="o">=</span> <span class="n">Help</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">thehelp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.view">
<a class="viewcode-back" href="../index.html#boonify.Boonify.view">[docs]</a>
    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;BooN View&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QView</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QView</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.stablestates">
<a class="viewcode-back" href="../index.html#boonify.Boonify.stablestates">[docs]</a>
    <span class="k">def</span> <span class="nf">stablestates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stable States View&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span> <span class="o">=</span> <span class="n">StableStates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QStableStates</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.model">
<a class="viewcode-back" href="../index.html#boonify.Boonify.model">[docs]</a>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Model View&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MODELBOUND</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;No Model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The number of variables exceeds </span><span class="si">{</span><span class="n">MODELBOUND</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">The model cannot be drawn.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QModel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Boonify.controllability">
<a class="viewcode-back" href="../index.html#boonify.Boonify.controllability">[docs]</a>
    <span class="k">def</span> <span class="nf">controllability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Controllability View&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span> <span class="o">=</span> <span class="n">Controllability</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QControllability</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">boonsaved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">NOTSAVED</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2B24</span><span class="s1">&#39;</span>
        <span class="n">SAVED</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u25CB</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">SAVED</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">NOTSAVED</span><span class="p">)</span></div>



<span class="c1"># DEF:  WIDGET CLASSES</span>

<div class="viewcode-block" id="Help">
<a class="viewcode-back" href="../index.html#boonify.Help">[docs]</a>
<span class="k">class</span> <span class="nc">Help</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Help Class used for showing help.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Help</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/help.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CloseButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">QWebEngineView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WebContainer</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;BooNGui/Help.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">setHtml</span><span class="p">(</span><span class="n">html</span><span class="p">)</span></div>



<div class="viewcode-block" id="View">
<a class="viewcode-back" href="../index.html#boonify.View">[docs]</a>
<span class="k">class</span> <span class="nc">View</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;View Class used for showing the BooN formula in a table.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">View</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/view.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">LOGICAL</span>  <span class="c1"># Style of the formulas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>  <span class="c1"># parent = Boonify class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># formulas of BooN</span>

        <span class="c1"># STEP: Set the functions related to signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CloseButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DnfButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convertdnf</span><span class="p">)</span>

        <span class="c1"># STEP: Combox Box of style.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_styling</span><span class="p">)</span>

        <span class="c1"># STEP: Forbid the edition of BooNContent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

        <span class="c1"># STEP: Resize columns of the table to content.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># STEP: Fix size of the  formula columns.</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="o">.</span><span class="n">Interactive</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_view</span><span class="p">()</span>

<div class="viewcode-block" id="View.initialize_view">
<a class="viewcode-back" href="../index.html#boonify.View.initialize_view">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill the table.&quot;&quot;&quot;</span>
        <span class="n">theboon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span>

        <span class="c1"># STEP: Initialize the formula fields.</span>
        <span class="n">nbrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">nbrow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span> <span class="o">=</span> <span class="p">[</span><span class="n">QLineEdit</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbrow</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_formula</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setFrame</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># STEP: Fill the table</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>  <span class="c1"># variable</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">logic</span><span class="o">.</span><span class="n">prettyform</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>  <span class="c1"># formula</span>

            <span class="k">if</span> <span class="n">is_dnf</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>  <span class="c1"># type of the formula</span>
                <span class="n">form</span> <span class="o">=</span> <span class="s2">&quot;DNF&quot;</span>
            <span class="k">elif</span> <span class="n">is_cnf</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>
                <span class="n">form</span> <span class="o">=</span> <span class="s2">&quot;CNF&quot;</span>
            <span class="k">elif</span> <span class="n">is_nnf</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>
                <span class="n">form</span> <span class="o">=</span> <span class="s2">&quot;NNF&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">form</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="View.change_formula">
<a class="viewcode-back" href="../index.html#boonify.View.change_formula">[docs]</a>
    <span class="k">def</span> <span class="nf">change_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the BooN from a formula change.&quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BooNContent</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>  <span class="c1"># get the current modified row</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formulas</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>  <span class="c1"># get the text of the lineedit formula</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="n">parse_expr</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># parse the input</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;SYNTAX ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;Syntax Error.</span><span class="se">\n</span><span class="s2">The formula is not changed.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c1"># Determine whether a new variable is used.</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">free_symbols</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;VARIABLES ERROR&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The following variables do not exist:</span><span class="se">\n</span><span class="si">{</span><span class="n">diff</span><span class="si">}</span><span class="se">\n</span><span class="s2">The formula is not changed.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">variable</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">row</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>  <span class="c1"># update the BooN</span>

        <span class="c1"># Refresh open widgets and editgraph.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span></div>


<div class="viewcode-block" id="View.cb_styling">
<a class="viewcode-back" href="../index.html#boonify.View.cb_styling">[docs]</a>
    <span class="k">def</span> <span class="nf">cb_styling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Style from combo box selection&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">STYLE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_view</span><span class="p">()</span>  <span class="c1"># Refresh the view.</span></div>


<div class="viewcode-block" id="View.convertdnf">
<a class="viewcode-back" href="../index.html#boonify.View.convertdnf">[docs]</a>
    <span class="k">def</span> <span class="nf">convertdnf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the BooN into DNF.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">dnf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_view</span><span class="p">()</span>  <span class="c1"># Refresh the view.</span></div>
</div>



<div class="viewcode-block" id="StableStates">
<a class="viewcode-back" href="../index.html#boonify.StableStates">[docs]</a>
<span class="k">class</span> <span class="nc">StableStates</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle stable states computation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StableStates</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/stablestates.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;Icon Boolean&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Button and Combo Box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CloseButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_styling</span><span class="p">)</span>

        <span class="c1"># shrink the header to size</span>
        <span class="n">Hheader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StableStatesPanel</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
        <span class="n">Hheader</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stablestates</span><span class="p">()</span>

<div class="viewcode-block" id="StableStates.cb_styling">
<a class="viewcode-back" href="../index.html#boonify.StableStates.cb_styling">[docs]</a>
    <span class="k">def</span> <span class="nf">cb_styling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select style from combo box selection&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stablestates</span><span class="p">()</span>  <span class="c1"># Refresh the stable states view.</span></div>


<div class="viewcode-block" id="StableStates.stablestates">
<a class="viewcode-back" href="../index.html#boonify.StableStates.stablestates">[docs]</a>
    <span class="k">def</span> <span class="nf">stablestates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute stable states and arrange the view.&quot;&quot;&quot;</span>
        <span class="n">theboon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">theboon</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">stablestates</span> <span class="o">=</span> <span class="n">theboon</span><span class="o">.</span><span class="n">stable_states</span>

        <span class="c1"># Define a model of data to store stable states.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">QStandardItemModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">setVerticalHeaderLabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">])</span>

        <span class="c1"># Fill the table.</span>
        <span class="k">for</span> <span class="n">stable</span> <span class="ow">in</span> <span class="n">stablestates</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">()</span>
                <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">ICON01</span><span class="p">[</span><span class="n">stable</span><span class="p">[</span><span class="n">var</span><span class="p">]]),</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
                <span class="n">icon</span><span class="o">.</span><span class="n">pixmap</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>

                <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">:</span>  <span class="c1"># define the view from the style</span>
                    <span class="k">case</span> <span class="s1">&#39;Icon&#39;</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">case</span> <span class="s1">&#39;Icon Boolean&#39;</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stable</span><span class="p">[</span><span class="n">var</span><span class="p">]))</span>
                    <span class="k">case</span> <span class="s1">&#39;Icon 0-1&#39;</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">stable</span><span class="p">[</span><span class="n">var</span><span class="p">])))</span>
                    <span class="k">case</span> <span class="s1">&#39;Boolean&#39;</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stable</span><span class="p">[</span><span class="n">var</span><span class="p">]))</span>
                    <span class="k">case</span> <span class="s1">&#39;0-1&#39;</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">stable</span><span class="p">[</span><span class="n">var</span><span class="p">])))</span>
                    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

                <span class="n">item</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
                <span class="n">column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">appendColumn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StableStatesPanel</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../index.html#boonify.Model">[docs]</a>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle model of dynamics.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/model.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CloseButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
        <span class="c1"># STEP: initialize attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">asynchronous</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">hypercube_layout</span>

        <span class="c1"># STEP: Connect Matplotlib widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">Figure</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelCanvas</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="c1"># STEP: connect functions to signals.</span>
        <span class="c1"># Radio Button to select the mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AsynchronousButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SynchronousButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb_mode</span><span class="p">)</span>
        <span class="c1"># Network layout Combo box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NetworkLayout</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_network_layout</span><span class="p">)</span>

        <span class="c1"># STEP: Modeling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeling</span><span class="p">()</span>

<div class="viewcode-block" id="Model.rb_mode">
<a class="viewcode-back" href="../index.html#boonify.Model.rb_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">rb_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mode selection from radio button box.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AsynchronousButton</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">asynchronous</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">SynchronousButton</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">synchronous</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeling</span><span class="p">()</span></div>


<div class="viewcode-block" id="Model.cb_network_layout">
<a class="viewcode-back" href="../index.html#boonify.Model.cb_network_layout">[docs]</a>
    <span class="k">def</span> <span class="nf">cb_network_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the layout of the network model from combo box.&quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NetworkLayout</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">match</span> <span class="n">layout</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;Hypercube&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">hypercube_layout</span>
            <span class="k">case</span> <span class="s2">&quot;Circular&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span>
            <span class="k">case</span> <span class="s2">&quot;Spring&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span>
            <span class="k">case</span> <span class="s2">&quot;Kamada Kawai&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">kamada_kawai_layout</span>
            <span class="k">case</span> <span class="s2">&quot;Random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">random_layout</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="n">logic</span><span class="o">.</span><span class="n">errmsg</span><span class="p">(</span><span class="s2">&quot;Internal Error - Unknown layout - Please contact the development team&quot;</span><span class="p">,</span> <span class="s2">&quot;cb_network_layout&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeling</span><span class="p">()</span></div>


<div class="viewcode-block" id="Model.modeling">
<a class="viewcode-back" href="../index.html#boonify.Model.modeling">[docs]</a>
    <span class="k">def</span> <span class="nf">modeling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the model of dynamics.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Empty datamodel = empty BooN</span>
            <span class="k">return</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">draw_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="Controllability">
<a class="viewcode-back" href="../index.html#boonify.Controllability">[docs]</a>
<span class="k">class</span> <span class="nc">Controllability</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Controllability class&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Controllability</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="s1">&#39;BooNGui/controllability.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># current control actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># row number corresponding to the selected solutions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_controllability</span><span class="p">()</span>

<div class="viewcode-block" id="Controllability.initialize_controllability">
<a class="viewcode-back" href="../index.html#boonify.Controllability.initialize_controllability">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_controllability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the controllability widget.&quot;&quot;&quot;</span>
        <span class="n">theboon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">theboon</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">nbrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>

        <span class="c1"># STEP : set the controllability as the function of the thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controllability</span><span class="p">)</span>

        <span class="c1"># STEP: Initialize Destiny page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">nbrow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">resizeColumnToContents</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># fit size to content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># fill the destiny table</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="c1"># Add variable name</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="c1"># Add a status for each variable</span>
            <span class="n">statusbox</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># item of the status box</span>
            <span class="n">statusbox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">])</span>  <span class="c1"># possible status</span>

            <span class="c1"># insert icons for each status</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">ICON01</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>  <span class="c1"># icon for None</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">pixmap</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
            <span class="n">statusbox</span><span class="o">.</span><span class="n">setItemIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">ICON01</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span>  <span class="c1"># icon for True</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">pixmap</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
            <span class="n">statusbox</span><span class="o">.</span><span class="n">setItemIcon</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">ICON01</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span>  <span class="c1"># icon for False</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">pixmap</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
            <span class="n">statusbox</span><span class="o">.</span><span class="n">setItemIcon</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>

            <span class="c1"># insert the status box in the table and connect it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">statusbox</span><span class="p">)</span>
            <span class="n">statusbox</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destiny_to_observers</span><span class="p">)</span>

        <span class="c1"># STEP: Initialize the observer page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">nbrow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># fill the observer table</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="n">obschkbox</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>  <span class="c1"># add checkbox</span>
            <span class="n">obschkbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="n">obschkbox</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>
            <span class="n">obschkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">obschkbox</span><span class="p">)</span>

        <span class="c1"># STEP: Define signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observers_to_destiny</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ControlButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ControlActions</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actupon</span><span class="p">)</span>

        <span class="c1"># STEP: Set the destiny page as default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ControlPanel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># STEP: Set size of columns</span>
        <span class="c1"># fit to content for ControlPanel</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ControlPanel</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ControlPanel</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>

        <span class="c1"># fit to content for ControlActions</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ControlActions</span><span class="o">.</span><span class="n">header</span><span class="p">()</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Controllability.destiny_to_observers">
<a class="viewcode-back" href="../index.html#boonify.Controllability.destiny_to_observers">[docs]</a>
    <span class="k">def</span> <span class="nf">destiny_to_observers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the observer w.r.t. the destiny change.&quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span></div>


<div class="viewcode-block" id="Controllability.observers_to_destiny">
<a class="viewcode-back" href="../index.html#boonify.Controllability.observers_to_destiny">[docs]</a>
    <span class="k">def</span> <span class="nf">observers_to_destiny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chkitem</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify the destiny w.r.t. the observer change&quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">chkitem</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chkitem</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="n">combobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">combobox</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Controllability.controllability">
<a class="viewcode-back" href="../index.html#boonify.Controllability.controllability">[docs]</a>
    <span class="k">def</span> <span class="nf">controllability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the control actions based on the destiny and the observers.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">theboon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">theboon</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

        <span class="c1"># STEP: Get the observers</span>
        <span class="n">controlledvars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Observers</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controlledvars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variables</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>

        <span class="c1"># STEP: Get the query formula</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">combobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Destiny</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">match</span> <span class="n">combobox</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
                <span class="k">case</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">case</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">variables</span><span class="p">[</span><span class="n">row</span><span class="p">]:</span> <span class="kc">True</span><span class="p">})</span>
                <span class="k">case</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">variables</span><span class="p">[</span><span class="n">row</span><span class="p">]:</span> <span class="kc">False</span><span class="p">})</span>

        <span class="c1"># STEP: Convert the state profiles into minterm</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="n">SOPform</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">query</span><span class="p">])</span>
        <span class="c1"># Check whether the query must be reached or avoid.</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">QueryType</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
            <span class="k">case</span> <span class="s2">&quot;Reach&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">case</span> <span class="s2">&quot;Avoid&quot;</span><span class="p">:</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="n">Not</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>

        <span class="c1"># STEP: Add control</span>
        <span class="n">boonctrl</span> <span class="o">=</span> <span class="n">theboon</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">boonctrl</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">controlledvars</span><span class="p">,</span> <span class="n">controlledvars</span><span class="p">)</span>

        <span class="c1"># STEP: Interpret the modality of the query (possibility, necessity).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Possibility</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># Possibility</span>
            <span class="n">possibility</span> <span class="o">=</span> <span class="n">boonctrl</span><span class="o">.</span><span class="n">possibly</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possibility</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Necessity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># Necessity</span>
            <span class="n">necessity</span> <span class="o">=</span> <span class="n">boonctrl</span><span class="o">.</span><span class="n">necessary</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Trace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">necessity</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">destiny</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">possibility</span><span class="p">,</span> <span class="n">necessity</span><span class="p">)</span>

        <span class="c1"># STEP: Destify the controlled BooN and transform the solutions into control actions (var, Boolean Value)</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">BooN</span><span class="o">.</span><span class="n">destify</span><span class="p">(</span><span class="n">destiny</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Trace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">boon</span><span class="o">.</span><span class="n">core2actions</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>

        <span class="c1"># STEP: Define the tree model to show the resulting actions.</span>
        <span class="n">treemodel</span> <span class="o">=</span> <span class="n">QStandardItemModel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Add 2 columns</span>
        <span class="n">treemodel</span><span class="o">.</span><span class="n">setHeaderData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">,</span> <span class="s2">&quot;Variable&quot;</span><span class="p">)</span>
        <span class="n">treemodel</span><span class="o">.</span><span class="n">setHeaderData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">,</span> <span class="s2">&quot;Boolean value&quot;</span><span class="p">)</span>

        <span class="n">root</span> <span class="o">=</span> <span class="n">treemodel</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">()</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">case</span> <span class="p">[]:</span>  <span class="c1"># No actions</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;No action found.&quot;</span><span class="p">)</span>
                <span class="n">root</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">case</span> <span class="p">[[]]:</span>  <span class="c1"># The destiny profile is already obtained</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;The marking profile already exists.&quot;</span><span class="p">)</span>
                <span class="n">root</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>  <span class="c1"># Compute the control actions.</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">actions</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># create the root solution</span>
                    <span class="n">rootactions</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Solution </span><span class="si">{:2d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="c1"># add the control actions of this solution</span>
                    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                        <span class="c1"># a control action is displayed as: variable + Boolean icon + Boolean value</span>
                        <span class="n">variable</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">ICON01</span><span class="p">[</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                        <span class="n">icon</span><span class="o">.</span><span class="n">pixmap</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">QStandardItem</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">rootactions</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>
                    <span class="c1"># append the solution to the tree model</span>
                    <span class="n">root</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">rootactions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ControlActions</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">treemodel</span><span class="p">)</span>  <span class="c1"># set the data model to tree widget enabling its display.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ControlActions</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span></div>


<div class="viewcode-block" id="Controllability.select_action">
<a class="viewcode-back" href="../index.html#boonify.Controllability.select_action">[docs]</a>
    <span class="k">def</span> <span class="nf">select_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep the selection solution&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">row</span><span class="p">()</span> <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">row</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">arg</span><span class="o">.</span><span class="n">row</span><span class="p">()</span></div>


<div class="viewcode-block" id="Controllability.actupon">
<a class="viewcode-back" href="../index.html#boonify.Controllability.actupon">[docs]</a>
    <span class="k">def</span> <span class="nf">actupon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the selection actions on the BooN.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]:</span>
                <span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">action</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">boon</span><span class="o">.</span><span class="n">desc</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">add_history</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setup_design</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="Threader">
<a class="viewcode-back" href="../index.html#boonify.Threader">[docs]</a>
<span class="k">class</span> <span class="nc">Threader</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class executing a thread to run an application.&quot;&quot;&quot;</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

        <span class="c1"># Create the thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<div class="viewcode-block" id="Threader.run">
<a class="viewcode-back" href="../index.html#boonify.Threader.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;run the application&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">()</span>  <span class="c1"># run the application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Emit the end signal</span></div>


<div class="viewcode-block" id="Threader.apply">
<a class="viewcode-back" href="../index.html#boonify.Threader.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fix the application running in the thread.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span></div>


<div class="viewcode-block" id="Threader.quit">
<a class="viewcode-back" href="../index.html#boonify.Threader.quit">[docs]</a>
    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;terminate the thread&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>
</div>



<span class="c1"># DEF:  MAIN</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">boonify</span> <span class="o">=</span> <span class="n">Boonify</span><span class="p">()</span>
    <span class="n">callback</span> <span class="o">=</span> <span class="n">boonify</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;draw_event&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">boonify</span><span class="o">.</span><span class="n">design</span><span class="p">())</span>
    <span class="n">boonify</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Franck Delaplace.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>